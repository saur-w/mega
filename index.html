<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tavares e Agregados - Mega da Virada 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gradient-to-br from-green-900 via-green-800 to-emerald-900 min-h-screen p-4">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
    const { useState, useEffect } = React;

    // --- CREDENCIAIS SUPABASE ---
    const SUPABASE_URL = 'https://pyhkhudqlbimkowvqtxe.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5aGtodWRxbGJpbWtvd3ZxdHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NTQxMzIsImV4cCI6MjA4MjUzMDEzMn0.ifgPFlRb9LHZHq3_H2sHMPY7wSpvRXDtaJikI0U86eE';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const SENHA_ACESSO = '2025';
    const VALOR_TOTAL_BOLAO = 810.00;

    const PARTICIPANTES_INICIAIS = [
        { id: 1, nome: "Sara Santana", cotas: 3, valorPago: 45.00, numeros: [] },
        { id: 2, nome: "Cida Regoso", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 3, nome: "Paula & Mion", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 4, nome: "Bia Rowies", cotas: 1, valorPago: 15.00, numeros: [] },
        { id: 5, nome: "Carolzinha Bonitatibus", cotas: 1, valorPago: 15.00, numeros: [] },
        { id: 6, nome: "Cris Rowies", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 7, nome: "Malu Souto", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 8, nome: "Jose Vicente", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 9, nome: "Rosely Ber", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 10, nome: "Juliana Regoso", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 11, nome: "Julia Rowies", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 12, nome: "Cida Pires", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 13, nome: "Ju & Anna", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 14, nome: "Mariana Granha", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 15, nome: "Marcia Teixeira", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 16, nome: "Mariana & Marcellus", cotas: 4, valorPago: 60.00, numeros: [] },
        { id: 17, nome: "Ricardo Granha", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 18, nome: "Cecilia & S√©rgio", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 19, nome: "Adriana", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 20, nome: "Andr√© & Ju", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 21, nome: "Estela Souto", cotas: 4, valorPago: 60.00, numeros: [] },
        { id: 22, nome: "Fatima", cotas: 1, valorPago: 15.00, numeros: [] },
        { id: 23, nome: "Leticia", cotas: 2, valorPago: 30.00, numeros: [] },
        { id: 24, nome: "Marcus e Gabs", cotas: 4, valorPago: 60.00, numeros: [] },
        { id: 25, nome: "Alana e Pedro", cotas: 2, valorPago: 30.00, numeros: [] }
    ];

    function App() {
        const [logado, setLogado] = useState(false);
        const [senhaInput, setSenhaInput] = useState('');
        const [participantes, setParticipantes] = useState(PARTICIPANTES_INICIAIS);
        const [participanteSelecionado, setParticipanteSelecionado] = useState(null);
        const [numerosEscolhidos, setNumerosEscolhidos] = useState([]);
        const [estrategia, setEstrategia] = useState('hibrida-b');
        const [apostas, setApostas] = useState([]);
        const [aprovacoes, setAprovacoes] = useState([]);
        const [nomeAprovacao, setNomeAprovacao] = useState('');
        const [sugestoes, setSugestoes] = useState([]);
        const [novaSugestao, setNovaSugestao] = useState('');

        // --- PERSIST√äNCIA ---
        const salvarNoBanco = async (novoEstado) => {
            await supabaseClient.from('bolao_data').upsert({ id: 'estado_geral', content: novoEstado, updated_at: new Date() });
        };

        const carregarDados = async () => {
            const { data } = await supabaseClient.from('bolao_data').select('content').eq('id', 'estado_geral').single();
            if (data?.content) {
                const c = data.content;
                if (c.participantes) setParticipantes(c.participantes);
                if (c.apostas) setApostas(c.apostas);
                if (c.estrategia) setEstrategia(c.estrategia);
                if (c.aprovacoes) setAprovacoes(c.aprovacoes);
                if (c.sugestoes) setSugestoes(c.sugestoes);
            }
        };

        useEffect(() => { carregarDados(); }, []);

        // --- FUN√á√ïES ---
        const salvarNumeros = async () => {
            const novos = participantes.map(p => p.id === participanteSelecionado.id ? {...p, numeros: numerosEscolhidos} : p);
            setParticipantes(novos);
            await salvarNoBanco({ participantes: novos, apostas, estrategia, aprovacoes, sugestoes });
            alert('N√∫meros sincronizados!');
            setParticipanteSelecionado(null);
        };

        const adicionarSugestao = async () => {
            const nome = prompt('Quem est√° sugerindo este jogo?');
            if (!nome || !novaSugestao) return;
            const novas = [...sugestoes, { nome, sugestao: novaSugestao, data: new Date().toLocaleString() }];
            setSugestoes(novas);
            await salvarNoBanco({ participantes, apostas, estrategia, aprovacoes, sugestoes: novas });
            setNovaSugestao('');
        };

        const gerarApostas = async () => {
            // L√≥gica de sorteio baseada no pool de n√∫meros do grupo
            const pool = [...new Set(participantes.flatMap(p => p.numeros))].sort((a,b) => a-b);
            if (pool.length < 6) return alert('O grupo precisa escolher mais n√∫meros!');
            
            const sortear = (n) => {
                let res = [], temp = [...pool];
                while(res.length < n && temp.length > 0) res.push(temp.splice(Math.floor(Math.random()*temp.length), 1)[0]);
                while(res.length < n) { let r = Math.floor(Math.random()*60)+1; if(!res.includes(r)) res.push(r); }
                return res.sort((a,b)=>a-b);
            };

            let novas = [];
            if (estrategia === 'hibrida-a') {
                novas.push({tipo: '9 n√∫meros', nums: sortear(9)});
                novas.push({tipo: '7 n√∫meros', nums: sortear(7)}, {tipo: '7 n√∫meros', nums: sortear(7)});
                for(let i=0; i<10; i++) novas.push({tipo: '6 n√∫meros', nums: sortear(6)});
            } else {
                novas.push({tipo: '9 n√∫meros', nums: sortear(9)});
                for(let i=0; i<5; i++) novas.push({tipo: '7 n√∫meros', nums: sortear(7)});
                for(let i=0; i<16; i++) novas.push({tipo: '6 n√∫meros', nums: sortear(6)});
            }
            setApostas(novas);
            await salvarNoBanco({ participantes, apostas: novas, estrategia, aprovacoes, sugestoes });
        };

        // --- RENDERS ---
        if (!logado) return (
            <div className="max-w-md mx-auto mt-20 p-8 bg-white rounded-lg shadow-xl text-center">
                <h1 className="text-2xl font-bold mb-6 text-green-800">üé∞ Bol√£o Tavares 2025</h1>
                <input type="password" value={senhaInput} onChange={e => setSenhaInput(e.target.value)} className="w-full p-3 border-2 rounded mb-4 text-center" placeholder="Senha" />
                <button onClick={() => senhaInput === SENHA_ACESSO ? setLogado(true) : alert('Erro')} className="w-full bg-green-600 text-white py-3 rounded font-bold">Entrar</button>
            </div>
        );

        if (participanteSelecionado) return (
            <div className="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-xl mt-10">
                <h2 className="text-xl font-bold mb-4">N√∫meros de {participanteSelecionado.nome}</h2>
                <div className="grid grid-cols-10 gap-2 mb-6">
                    {Array.from({length: 60}, (_, i) => i + 1).map(n => (
                        <button key={n} onClick={() => {
                            if (numerosEscolhidos.includes(n)) setNumerosEscolhidos(numerosEscolhidos.filter(x => x !== n));
                            else if (numerosEscolhidos.length < 6) setNumerosEscolhidos([...numerosEscolhidos, n]);
                        }} className={`p-2 rounded font-bold ${numerosEscolhidos.includes(n) ? 'bg-green-600 text-white' : 'bg-gray-100'}`}>{n}</button>
                    ))}
                </div>
                <button onClick={salvarNumeros} className="w-full bg-green-600 text-white py-3 rounded font-bold">Salvar Escolha</button>
            </div>
        );

        return (
            <div className="max-w-6xl mx-auto text-white">
                <header className="text-center py-8">
                    <h1 className="text-4xl font-black uppercase">Mega da Virada 2025</h1>
                    <p className="bg-yellow-400 text-green-900 px-4 py-1 rounded-full inline-block font-bold mt-2">Or√ßamento: R$ {VALOR_TOTAL_BOLAO}</p>
                </header>

                <div className="grid lg:grid-cols-3 gap-6 text-black">
                    {/* Lista Original de Participantes */}
                    <div className="lg:col-span-2 bg-white p-6 rounded-lg border-2 border-gray-300">
                        <h2 className="text-xl font-bold mb-4 border-b pb-2">üë• Participantes</h2>
                        <div className="grid md:grid-cols-2 gap-2 max-h-[500px] overflow-y-auto">
                            {participantes.map(p => (
                                <div key={p.id} className="p-3 bg-gray-50 border rounded-lg flex justify-between items-center">
                                    <div><p className="font-bold text-sm">{p.nome}</p><p className="text-xs text-gray-500">{p.cotas} cotas</p></div>
                                    <button onClick={() => abrirEscolhaNumeros(p)} className="bg-green-600 text-white px-3 py-1 rounded text-xs font-bold">Escolher</button>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="space-y-6">
                        {/* Se√ß√£o de Estrat√©gia */}
                        <div className="bg-white p-6 rounded-lg border-2 border-gray-300">
                            <h3 className="font-bold mb-3 uppercase text-sm text-gray-500">‚öôÔ∏è Definir Jogo Oficial</h3>
                            <select value={estrategia} onChange={e => setEstrategia(e.target.value)} className="w-full p-2 border rounded mb-4 font-bold">
                                <option value="hibrida-a">Op√ß√£o A (R$ 648)</option>
                                <option value="hibrida-b">Op√ß√£o B (R$ 810)</option>
                            </select>
                            <button onClick={gerarApostas} className="w-full bg-purple-600 text-white py-3 rounded font-bold text-sm shadow-md">Gerar Apostas do Grupo</button>
                        </div>

                        {/* SE√á√ÉO DE SUGEST√ÉO DE JOGOS (O QUE VOC√ä PEDIU) */}
                        <div className="bg-gray-50 p-6 rounded-lg border-2 border-gray-300 shadow-inner">
                            <h3 className="text-lg font-black mb-4 text-blue-900">üó≥Ô∏è Sugest√µes de Jogos / Estrat√©gias</h3>
                            <textarea value={novaSugestao} onChange={e => setNovaSugestao(e.target.value)} 
                                placeholder="Ex: Sugiro o jogo [01, 05, 20...] porque s√£o datas da fam√≠lia." 
                                className="w-full p-3 border-2 rounded-lg h-28 text-sm mb-2" />
                            <button onClick={adicionarSugestao} className="w-full bg-blue-600 text-white py-2 rounded-lg font-bold text-sm">Postar Sugest√£o para Vota√ß√£o</button>
                            
                            <div className="mt-4 space-y-3 max-h-60 overflow-y-auto">
                                {sugestoes.map((s, i) => (
                                    <div key={i} className="bg-white p-3 rounded-lg border-l-4 border-blue-500 shadow-sm">
                                        <div className="flex justify-between text-[10px] font-bold text-gray-400 mb-1">
                                            <span>{s.nome.toUpperCase()}</span><span>{s.data}</span>
                                        </div>
                                        <p className="text-sm font-medium text-gray-700 leading-tight">{s.sugestao}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>

                {/* √Årea de Visualiza√ß√£o das Apostas */}
                {apostas.length > 0 && (
                    <div className="mt-10 bg-white text-black p-8 rounded-lg border-2 border-gray-300 mb-20">
                        <h2 className="text-2xl font-black mb-6 border-b pb-4">üìù Jogos Oficiais do Bol√£o</h2>
                        <div className="grid md:grid-cols-3 gap-4">
                            {apostas.map((a, i) => (
                                <div key={i} className="p-4 border-2 border-dashed rounded-xl bg-gray-50">
                                    <p className="text-[10px] font-bold text-gray-400 uppercase mb-2">{a.tipo}</p>
                                    <div className="flex flex-wrap gap-2">
                                        {a.nums.map(n => <span key={n} className="h-8 w-8 rounded-full border-2 border-green-600 flex items-center justify-center font-bold text-green-700 bg-white text-sm">{n}</span>)}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}
            </div>
        );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
